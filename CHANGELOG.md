## 变更记录（按与助手的交互阶段）

### 阶段一：实现模块一（文件IO与场景初始化）
- 新增文件：`index.html`、`src/main.js`、`src/ui.js`
- 主要调整：
  - 集成 Three.js 场景、相机、灯光、`OrbitControls`
  - 支持加载本地 `.stl`（`STLLoader` 解析、居中、法线计算、透明材质）
  - 导入/导出 `.json`（点集数据）
  - 牙模透明度滑块控制，仅影响网格材质
- 已完成功能：
  - 基础UI与项目骨架
  - 模型加载、镜头控制、JSON IO、透明度调节

### 阶段二：实现模块二与模块三（参考平面与路径设计）
- 更新 `index.html`：新增参考平面与路径设计的UI区块
- 更新 `src/main.js`：
  - 参考平面：三点点选、拖拽（`DragControls`）、法向计算、`PlaneGeometry`可视化、显隐切换
  - 路径设计：
    - 绘制模式：点击牙模添加点，依据面法线外偏移弓丝半径
    - 编辑模式：拖拽红点实时更新路径
    - 曲线渲染：直线（`CurvePath` + `LineCurve3`）/ 平滑（`CatmullRomCurve3`）+ `TubeGeometry`
    - 清除全部
- 已完成功能：
  - 参考平面定义与确认
  - 路径绘制、编辑、曲线渲染与清空

### 阶段三：实现模块四（U型曲生成）与模块六（撤销）
- 更新 `index.html`：
  - 新增按钮：`生成U型曲`、`撤销（Ctrl+Z）`
  - 提示：编辑模式下 `Shift` + 单击选择两个端点
- 更新 `src/main.js`：
  - 点选择：编辑模式下按 `Shift` + 单击点作为端点选择/取消；超过两个自动替换最早选择
  - U型曲生成：
    - 基于参考平面法向与端点方向确定朝向
    - 生成两臂与半圆顶（中间隐点不可见/不可拖拽）
    - 替换端点之间的原有路径段
  - 撤销：
    - 保存历史（加点、拖拽、清空、生成U型曲、导入）
    - 支持按钮与 `Ctrl+Z` 撤销
- 已完成功能：
  - U型曲交互生成
  - 稳定的历史栈与撤销机制

### 阶段四：参数化与规范细化（依据《唇弓矫正器设计说明》）
- 更新 `index.html`：
  - 新增“参数设置”模态框（路径设计标题右侧齿轮按钮）
  - 可调参数：弓丝直径、点直径、U型曲宽度/高度/末端离组织面距离
- 更新 `src/main.js`：
  - 参数管理：装载/保存（`localStorage` 持久化）、显示/隐藏模态、应用与重绘
  - U型曲算法优化：
    - 宽度不超过端点距离80%，避免几何异常
    - 末端按法向偏移满足组织面距离要求
- 已完成功能：
  - 可视化参数面板与持久化
  - 规范化U型曲生成（宽度/高度/末端距离）

### 文件清单（关键）
- `index.html`：页面与所有UI、参数模态
- `src/main.js`：Three.js场景、参考平面、路径交互、U型曲、撤销、参数化
- `src/ui.js`：UI工具占位（为后续扩展保留）

### 使用提示
1. 加载STL → 设置并确认参考平面
2. 路径设计：绘制点或编辑点
3. 编辑模式下 `Shift+单击` 选择两个端点 → 生成U型曲
4. 点击设置图标调整参数（自动保存）
5. 需要回退可按 `Ctrl+Z` 或点击“撤销”
