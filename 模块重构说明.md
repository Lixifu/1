# 模块重构说明

## 重构概述

成功将原本集中在 `main.js` 文件中的所有功能按功能模块分离，创建了三个独立的模块：

### 1. CoreModule.js - 核心模块
**功能范围：**
- 场景初始化和管理
- 模型加载（STL文件）
- 导入导出功能
- 相机控制和交互
- 参数管理
- 基础UI控制

**主要类和方法：**
- `initScene()` - 初始化Three.js场景
- `loadSTLFile()` - 加载STL模型
- `importJSONFile()` / `exportJSON()` - 导入导出功能
- `setStatus()` - 状态显示
- 参数管理相关方法

### 2. PlaneModule.js - 参考平面模块
**功能范围：**
- 参考平面定义和管理
- 接触点计算和显示
- 平面控制点交互
- 平面可见性控制

**主要类和方法：**
- `enterPlaneMode()` / `confirmPlane()` - 平面模式控制
- `calculateContactPoints()` - 计算接触点
- `addPlaneControlPoint()` - 添加平面控制点
- `updateReferencePlane()` - 更新参考平面
- `getContactPoints()` / `getReferencePlaneData()` - 数据获取

### 3. PathModule.js - 路径设计模块
**功能范围：**
- 路径绘制和编辑
- 各种设计模式（绘制、编辑、接触点、抛物线、AI生成）
- U型曲生成
- 撤销重做功能
- 路径平滑处理

**主要类和方法：**
- `toggleDrawMode()` / `toggleEditMode()` - 模式切换
- `addPointAtCursor()` - 添加路径点
- `generateULoopFromSelection()` - U型曲生成
- `generateSmoothCurve()` - 平滑曲线生成
- `undo()` / `saveState()` - 撤销功能

### 4. main.js - 主控制器
**功能范围：**
- 模块间协调
- 事件处理
- UI事件绑定
- 模块间通信

## 模块间通信

### 依赖关系
```
main.js
├── CoreModule (核心功能)
├── PlaneModule (依赖 CoreModule)
└── PathModule (依赖 CoreModule, PlaneModule)
```

### 回调机制
- `coreModule.onModelLoaded` - 模型加载完成回调
- `planeModule.onPlaneConfirmed` - 平面确认回调
- `pathModule.onPathUpdated` - 路径更新回调

### 数据流
1. **模型加载** → CoreModule → PlaneModule (启用平面UI)
2. **平面确认** → PlaneModule → PathModule (启用路径设计)
3. **路径更新** → PathModule → CoreModule (更新导出状态)

## 重构优势

### 1. 代码组织
- **单一职责**：每个模块专注于特定功能
- **低耦合**：模块间通过明确的接口通信
- **高内聚**：相关功能集中在同一模块

### 2. 可维护性
- **易于调试**：问题定位更精确
- **易于扩展**：新功能可以独立开发
- **易于测试**：模块可以独立测试

### 3. 代码复用
- **模块化设计**：模块可以在其他项目中复用
- **接口标准化**：统一的接口设计

## 文件结构

```
src/
├── CoreModule.js      # 核心模块
├── PlaneModule.js     # 参考平面模块  
├── PathModule.js      # 路径设计模块
├── main.js           # 主控制器
└── ui.js             # UI相关（保留）
```

## 使用说明

### 启动应用
应用会自动初始化所有模块并建立模块间的通信关系。

### 开发新功能
1. **核心功能** → 在 CoreModule 中添加
2. **平面相关** → 在 PlaneModule 中添加
3. **路径相关** → 在 PathModule 中添加
4. **模块协调** → 在 main.js 中添加

### 调试建议
- 使用浏览器开发者工具查看模块状态
- 通过回调函数追踪模块间通信
- 利用模块的getter方法获取内部状态

## 注意事项

1. **模块依赖**：确保模块按正确顺序初始化
2. **事件处理**：UI事件在main.js中统一处理
3. **数据同步**：通过回调机制保持模块间数据同步
4. **错误处理**：各模块应独立处理自己的错误

## 后续优化建议

1. **类型定义**：可以考虑添加TypeScript支持
2. **单元测试**：为每个模块编写单元测试
3. **文档完善**：为每个模块添加详细的API文档
4. **性能优化**：优化模块间的通信效率
